<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Tarun — Making Software</title>

<link href="https://fonts.googleapis.com/css2?family=EB+Garamond:wght@400;600&family=JetBrains+Mono:wght@300;400;600&family=Share+Tech+Mono&display=swap" rel="stylesheet">

<style>
:root{
  --blue:#1f5cff;
  --bg:#fdfdfd;
  --text:#1a1a1a;
  --mono:'JetBrains Mono',monospace;
  --tech:'Share Tech Mono',monospace;
  --serif:'EB Garamond',serif;
}

*{box-sizing:border-box}

body{
  margin:0;
  background:
    radial-gradient(rgba(31,92,255,.06) .8px, transparent .8px);
  background-size:14px 14px;
  background-color:var(--bg);
  font-family:var(--serif);
  color:var(--text);
}

.container{
  max-width:1100px;
  margin:auto;
  padding:40px;
}

/* ---------------- HERO LAYOUT ---------------- */
.hero{
  display:grid;
  grid-template-columns:1.2fr 1fr;
  gap:60px;
  margin-top:40px;
  align-items:center;
}

.nn-panel{
  border:1px solid rgba(31,92,255,.25);
  padding:18px;
  background:white;
}

.nn-label{
  font-family:var(--tech);
  font-size:11px;
  color:var(--blue);
  letter-spacing:2px;
  margin-bottom:10px;
}

/* ---------------- DRAW CANVAS ---------------- */
.canvas-wrap{
  position:relative;
  border:1px dashed rgba(31,92,255,.3);
  background:
    radial-gradient(rgba(31,92,255,.08) .7px, transparent .7px);
  background-size:10px 10px;
  width:140px;
  height:140px;
}

canvas{
  width:100%;
  height:100%;
  cursor:crosshair;
}

/* ---------------- NETWORK SVG ---------------- */
#nnSvg{
  width:420px;
  height:220px;
}

.nn-node{
  fill:white;
  stroke:var(--blue);
  stroke-width:1;
  opacity:.35;
}

.nn-node.active{
  fill:var(--blue);
  opacity:1;
}

.nn-edge{
  stroke:rgba(31,92,255,.15);
  stroke-width:.8;
}

.nn-edge.active{
  stroke:rgba(31,92,255,.6);
}

/* ---------------- OUTPUT ---------------- */
.output{
  margin-top:10px;
  font-family:var(--tech);
  font-size:14px;
  color:var(--blue);
}

.confidence{
  height:6px;
  width:100%;
  background:#eee;
  margin-top:6px;
  position:relative;
}

.confidence-fill{
  height:100%;
  width:0%;
  background:var(--blue);
}

/* ---------------- CONTROLS ---------------- */
.controls{
  display:flex;
  gap:8px;
  margin-top:10px;
}

button{
  font-family:var(--tech);
  font-size:12px;
  background:white;
  border:1px solid var(--blue);
  color:var(--blue);
  padding:6px 10px;
  cursor:pointer;
}

.toggle{
  font-family:var(--tech);
  font-size:11px;
  margin-left:auto;
}

h1{
  font-family:var(--tech);
  font-size:52px;
  margin:0;
  line-height:.9;
}

p{font-size:20px}

@media(max-width:900px){
  .hero{grid-template-columns:1fr}
  #nnSvg{width:100%}
}
</style>
</head>

<body>
<div class="container">

<!-- ---------------- HERO ---------------- -->
<section class="hero">

<!-- LEFT: INTERACTIVE NN -->
<div class="nn-panel">
  <div class="nn-label">HANDWRITTEN DIGIT → NEURAL NETWORK</div>

  <div style="display:flex;gap:20px;align-items:center;">
    <div class="canvas-wrap">
      <canvas id="draw" width="140" height="140"></canvas>
    </div>

    <svg id="nnSvg"></svg>
  </div>

  <div class="output" id="prediction">PREDICTED: —</div>
  <div class="confidence"><div class="confidence-fill" id="confFill"></div></div>

  <div class="controls">
    <button id="clear">Clear</button>
    <button id="run">Run</button>
    <div class="toggle">
      MODE:
      <select id="mode">
        <option value="template">TEMPLATE</option>
        <option value="heuristic">HEURISTIC</option>
      </select>
    </div>
  </div>
</div>

<!-- RIGHT: TEXT -->
<div>
  <h1>TARUN<br>MAKING<br>SOFTWARE</h1>
  <p>
    This visualization shows how a neural network processes handwritten digits:
    pixel activations propagate through learned layers and resolve into a single class.
  </p>
  <p>
    The goal isn’t accuracy — it’s clarity. Every decision here is inspectable.
  </p>
</div>

</section>

</div>

<!-- ---------------- SCRIPT ---------------- -->
<script>
/* ============ DRAWING ============ */
const canvas = document.getElementById("draw");
const ctx = canvas.getContext("2d");
ctx.lineWidth = 10;
ctx.lineCap = "round";
ctx.strokeStyle = "#1f5cff";

let drawing=false, points=[];

canvas.onpointerdown=e=>{
  drawing=true;
  ctx.beginPath();
  ctx.moveTo(e.offsetX,e.offsetY);
  points=[[e.offsetX,e.offsetY]];
};
canvas.onpointermove=e=>{
  if(!drawing) return;
  ctx.lineTo(e.offsetX,e.offsetY);
  ctx.stroke();
  points.push([e.offsetX,e.offsetY]);
};
canvas.onpointerup=()=>drawing=false;
canvas.onpointerleave=()=>drawing=false;

document.getElementById("clear").onclick=()=>{
  ctx.clearRect(0,0,canvas.width,canvas.height);
  points=[];
  resetNN();
};

/* ============ NETWORK ============ */
const layers=[12,10,8,10];
const svg=document.getElementById("nnSvg");
let nodes=[],edges=[];

function buildNN(){
  svg.innerHTML="";
  nodes=[];edges=[];
  const w=420,h=220;
  const lx=w/(layers.length-1);

  layers.forEach((n,l)=>{
    for(let i=0;i<n;i++){
      const cx=l*lx;
      const cy=(i+1)*h/(n+1);
      const c=document.createElementNS("http://www.w3.org/2000/svg","circle");
      c.setAttribute("cx",cx);
      c.setAttribute("cy",cy);
      c.setAttribute("r",4);
      c.classList.add("nn-node");
      svg.appendChild(c);
      nodes.push({el:c,layer:l,index:i});

      if(l>0){
        nodes.filter(p=>p.layer===l-1).forEach(p=>{
          const ln=document.createElementNS("http://www.w3.org/2000/svg","line");
          ln.setAttribute("x1",p.el.getAttribute("cx"));
          ln.setAttribute("y1",p.el.getAttribute("cy"));
          ln.setAttribute("x2",cx);
          ln.setAttribute("y2",cy);
          ln.classList.add("nn-edge");
          svg.insertBefore(ln,svg.firstChild);
          edges.push({el:ln,to:c});
        });
      }
    }
  });
}
buildNN();

function resetNN(){
  nodes.forEach(n=>n.el.classList.remove("active"));
  edges.forEach(e=>e.el.classList.remove("active"));
  document.getElementById("prediction").textContent="PREDICTED: —";
  document.getElementById("confFill").style.width="0%";
}

/* ============ DIGIT ESTIMATION ============ */
function estimateDigit(){
  if(points.length<5) return {digit:null,conf:0};

  let sx=0,sy=0;
  points.forEach(p=>{sx+=p[0];sy+=p[1]});
  const cx=sx/points.length, cy=sy/points.length;

  let digit=0;
  if(cy<40) digit=7;
  else if(cx>90) digit=1;
  else if(cy>90) digit=2;
  else if(cy>70 && cx<50) digit=6;
  else digit=0;

  const conf=Math.min(95,50+points.length/2);
  return {digit,conf};
}

/* ============ PROPAGATION ============ */
function runNN(){
  resetNN();
  const mode=document.getElementById("mode").value;
  const {digit,conf}=estimateDigit();
  let step=0;

  const timer=setInterval(()=>{
    nodes.forEach(n=>n.el.classList.toggle("active",n.layer===step));
    edges.forEach(e=>{
      e.el.classList.toggle("active",
        nodes.find(n=>n.el===e.to)?.layer===step);
    });

    if(step===layers.length-1 && digit!==null){
      nodes.filter(n=>n.layer===layers.length-1)
        .forEach(n=>n.el.classList.toggle("active",n.index===digit));
      document.getElementById("prediction").textContent=
        "PREDICTED: "+digit;
      document.getElementById("confFill").style.width=conf+"%";
    }

    step++;
    if(step>layers.length+1) clearInterval(timer);
  },320);
}

document.getElementById("run").onclick=runNN;

/* ============ KEYBOARD INPUT ============ */
window.addEventListener("keydown",e=>{
  if(e.key>='0'&&e.key<='9'){
    ctx.clearRect(0,0,canvas.width,canvas.height);
    ctx.font="100px EB Garamond";
    ctx.fillStyle="#1f5cff";
    ctx.fillText(e.key,35,110);
    points=[[70,70]]; // fake activation
    runNN();
  }
});
</script>

</body>
</html>
